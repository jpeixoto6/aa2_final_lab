---
# Tasks to delete instances, included as a loop in osp-instances-delete.yaml

    - name: Fetch Instance Info
      openstack.cloud.server_info:
        cloud: "{{ guid }}-project"
        server:  "{{ server_name }}"
        filters:
          vm_state: active
      register: result

    - name: Delete instances
      os_server:
        cloud: "{{ guid }}-project"
        name: "{{ item.name }}"
        state: absent
      loop: "{{ result.openstack_servers }}"
      loop_control:
        label: "{{ item.name }}"
      when: result != ""
